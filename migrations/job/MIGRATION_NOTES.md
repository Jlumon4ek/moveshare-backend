# Миграция от job_applications к executor_id

## Что изменилось

Старая система использовала отдельную таблицу `job_applications` для отслеживания заявок на работы.
Новая система использует поле `executor_id` в таблице `jobs` для прямого указания исполнителя.

## Изменения в базе данных

### Удалена таблица:
- `job_applications` - больше не используется

### Изменена таблица:
- `jobs.executor_id` - теперь содержит ID исполнителя (NULL для незанятых работ)

## Изменения в коде

### Обновлены файлы:
1. **`internal/repository/chat/has_job_access.go`**
   - Заменена логика проверки через `job_applications`
   - Теперь проверяет `contractor_id` и `executor_id` из таблицы `jobs`

2. **`internal/repository/review/repository.go`**
   - Метод `GetJobDetails` обновлен для использования `executor_id`
   - Убрана зависимость от `job_applications`

## Логика доступа

### Старая система:
```sql
-- Проверка доступа к чату
SELECT EXISTS(
    SELECT 1 
    FROM job_applications 
    WHERE job_id = ? AND user_id = ?
)
```

### Новая система:
```sql
-- Проверка доступа к чату
SELECT contractor_id, executor_id 
FROM jobs 
WHERE id = ?
-- Затем проверяем, что пользователи являются contractor или executor
```

## Преимущества новой системы

1. **Простота** - нет необходимости в отдельной таблице
2. **Производительность** - меньше JOIN-ов в запросах
3. **Целостность данных** - один источник истины для статуса работы
4. **Логичность** - статус работы и исполнитель хранятся вместе

## Статусы работ

- `open` - работа доступна для клейма (executor_id = NULL)
- `claimed` - работа взята исполнителем (executor_id заполнен)
- `pending` - загружены файлы, ожидает проверки
- `completed` - работа завершена

## Backward compatibility

Код полностью обновлен для работы с новой системой.
Старые ссылки на `job_applications` удалены или заменены на логику с `executor_id`.